# Hexo 博客源码使用说明

本目录是博客的 Hexo 源码，用于在本地编写文章并生成静态站点，发布到 GitHub Pages（访问地址：https://yuanhuatan.github.io）。

---

## 环境要求

- Node.js（建议 14+）
- Git（用于发布时提交与推送）
- 首次使用需在本目录执行一次：`npm install`

---

## 日常使用

### 1. 写新文章

**方式一：用命令生成一篇空白文章**

在 **hexo 目录**下执行：

```bash
npx hexo new "文章标题"
```

会在 `source/_posts/` 下生成 `文章标题.md`，编辑该文件即可。

**方式二：直接新建 Markdown**

在 `source/_posts/` 下手动新建 `.md` 文件，在文件开头写 front matter，例如：

```yaml
---
title: 我的新文章
date: 2025-02-08 12:00:00
tags:
  - 标签1
---
正文内容...
```

### 2. 本地预览

在 **hexo 目录**下执行：

```bash
npx hexo server
```

浏览器打开 http://localhost:4000 查看效果。修改文章或配置后保存，页面会自动刷新。

### 3. 发布到 GitHub（更新线上博客）

生成静态文件并把结果同步到仓库根目录，需在 **仓库根目录**（即 `yuanhuatan.github.io` 项目根，不是 hexo 目录）执行发布脚本。

**在 Git Bash 中执行：**

```bash
# 先进入仓库根目录
cd /d/workspace/github/yuanhuatan.github.io

# 执行发布脚本
bash scripts/publish.sh
```

脚本会依次：

1. 在 `hexo` 目录执行 `hexo generate` 生成静态文件；
2. 将 `hexo/public/` 下的全部内容复制到仓库根目录。

然后提交并推送到 GitHub：

```bash
git add .
git commit -m "更新博客"
git push
```

推送完成后，过一会儿即可在 https://yuanhuatan.github.io 看到更新。

---

## 目录结构说明

| 路径 | 说明 |
|------|------|
| `_config.yml` | Hexo 主配置（站点名、URL、permalink 等） |
| `_config.next.yml` | NexT 主题配置（外观、侧栏等） |
| `source/_posts/` | 所有文章的 Markdown 源文件 |
| `source/about/` | “关于”页面 |
| `public/` | 生成后的静态文件（由 `hexo g` 生成，已加入 .gitignore，不提交） |
| `source/_data/head.swig` | 自定义 head 注入（当前用于前端密码保护） |
| `source/js/password-gate.js` | 前端密码门脚本 |

---

## 前端密码保护（弱保护）

仅用于挡掉随便点进来的人，**不能防爬虫或会看源码的人**。访问者首次打开站点会看到密码输入框，输入正确后本次浏览器会话内不再询问。

**开启步骤：**

1. 在 **仓库根目录** 执行，生成密码对应的哈希（将 `你的密码` 换成实际密码）：
   ```bash
   node scripts/generate-pass-hash.js 你的密码
   ```
2. 打开 `hexo/_config.yml`，将输出的哈希填到 `password_hash: "这里"`，并改为：
   ```yaml
   password_protect: true
   password_hash: "刚才复制的哈希"
   ```
3. 重新生成并发布（执行 `bash scripts/publish.sh` 后提交推送）。

**关闭：** 将 `password_protect` 改为 `false` 或清空 `password_hash`，重新发布即可。

---

## 常用命令汇总（均在对应目录下执行）

| 操作 | 执行位置 | 命令 |
|------|----------|------|
| 安装依赖 | hexo 目录 | `npm install` |
| 新建文章 | hexo 目录 | `npx hexo new "标题"` |
| 本地预览 | hexo 目录 | `npx hexo server` |
| 仅生成（不发布） | hexo 目录 | `npx hexo generate` |
| **发布到仓库根目录** | **仓库根目录** | `bash scripts/publish.sh` |
| 生成密码哈希（用于开启密码保护） | 仓库根目录 | `node scripts/generate-pass-hash.js 你的密码` |

---

## 注意事项

- 发布脚本必须在 **仓库根目录** 执行 `bash scripts/publish.sh`，不要在 hexo 目录内执行。
- 若修改了主题或 Hexo 配置，发布前建议先执行 `npx hexo server` 在本地确认效果，再执行 `publish.sh` 并提交推送。
